# Protocol buffer processing
protobuf_generate_cpp(CDAP_GPB_SRC CDAP_GPB_HDR CDAP.proto)

# Libraries generated by the project
add_library(rina-api SHARED utils.c ker-numtables.c uipcps-numtables.c ctrl.c memtrack.c)
add_library(cdap SHARED cdap.cpp ${CDAP_GPB_SRC} ${CDAP_GPB_HDR})
add_library(rlite-conf SHARED conf.c)
add_library(rlite-wifi STATIC wifi.c)
add_library(rlite-raft STATIC raft.cpp)

target_link_libraries(cdap rina-api ${PROTOBUF_LIBRARY})
target_link_libraries(rlite-conf rina-api)
target_link_libraries(rlite-wifi wpa-supplicant)

message(STATUS "Adding include dir ${CMAKE_CURRENT_BINARY_DIR} to cdap target")
target_include_directories(cdap PUBLIC ${CMAKE_CURRENT_BINARY_DIR})

# Executables generated by the project
add_executable(cdap-test cdap-test.cpp)
add_executable(raft-test raft-test.cpp)

target_link_libraries(cdap-test cdap pthread)
target_link_libraries(raft-test rlite-raft)

# Installation directives
install(TARGETS rina-api cdap rlite-conf DESTINATION lib)
install(FILES ${CMAKE_CURRENT_BINARY_DIR}/CDAP.pb.h DESTINATION include/rlite)

add_test(NAME raft COMMAND raft-test)
add_test(NAME cdap COMMAND cdap-test)

add_subdirectory(swig)
add_subdirectory(wpa-supplicant)
